# Audio TTS Server

ะกะตัะฒะตั ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะพะทะฒััะบะธ ะฐัะดะธะพะบะฝะธะณ ั ะฟะพะดะดะตัะถะบะพะน FB2 ัะพัะผะฐัะฐ, ะพะฟัะตะดะตะปะตะฝะธะตะผ ะฟะตััะพะฝะฐะถะตะน ะธ ัะฐัััะฐะฝะพะฒะบะพะน ัะดะฐัะตะฝะธะน.

## ๐ฏ ะะฟะธัะฐะฝะธะต

Audio TTS Server - ััะพ ะบะพะผะฟะปะตะบัะฝะพะต ัะตัะตะฝะธะต ะดะปั ะฐะฒัะพะผะฐัะธัะตัะบะพะน ะณะตะฝะตัะฐัะธะธ ะฐัะดะธะพะบะฝะธะณ ะธะท ัะตะบััะพะฒัั ัะฐะนะปะพะฒ FB2. ะกะธััะตะผะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ:

- ะะฐััะธั FB2 ัะฐะนะปั ะธ ัะฐะทะฑะธะฒะฐะตั ะฝะฐ ะณะปะฐะฒั ะธ ะฟัะตะดะปะพะถะตะฝะธั
- ะะฟัะตะดะตะปัะตั ะฟะตััะพะฝะฐะถะตะน ะดะปั ะบะฐะถะดะพะณะพ ะฟัะตะดะปะพะถะตะฝะธั ัะตัะตะท Ollama AI
- ะะฐัััะฐะฒะปัะตั ัะดะฐัะตะฝะธั ะฒ ััััะบะพะผ ัะตะบััะต
- ะะตะฝะตัะธััะตั ะฐัะดะธะพ ั ะฟะพะผะพััั F5-TTS
- ะัะตะดะพััะฐะฒะปัะตั ะณะพัะพะฒัะต ะฐัะดะธะพ ัะฐะนะปั ะดะปั ัะบะฐัะธะฒะฐะฝะธั

## โจ ะะพะทะผะพะถะฝะพััะธ

- ๐ **ะะฐะณััะทะบะฐ FB2 ัะฐะนะปะพะฒ** ั ะฐะฒัะพะผะฐัะธัะตัะบะธะผ ะฟะฐััะธะฝะณะพะผ
- ๐ค **AI-ะพะฟัะตะดะตะปะตะฝะธะต ะฟะตััะพะฝะฐะถะตะน** ัะตัะตะท Ollama
- ๐ **ะะฒัะพะผะฐัะธัะตัะบะฐั ัะฐัััะฐะฝะพะฒะบะฐ ัะดะฐัะตะฝะธะน** 
- ๐ต **ะะตะฝะตัะฐัะธั ะบะฐัะตััะฒะตะฝะฝะพะณะพ ะฐัะดะธะพ** ัะตัะตะท F5-TTS
- ๐ฅ **ะฃะฟัะฐะฒะปะตะฝะธะต ะฟะตััะพะฝะฐะถะฐะผะธ ะธ ะณะพะปะพัะฐะผะธ**
- ๐ **ะะพะฝะธัะพัะธะฝะณ ะฟัะพะณัะตััะฐ ะพะฑัะฐะฑะพัะบะธ**
- ๐ **ะกะบะฐัะธะฒะฐะฝะธะต ะฟะพ ะฟัะตะดะปะพะถะตะฝะธัะผ, ะณะปะฐะฒะฐะผ ะธะปะธ ะบะฝะธะณะต ัะตะปะธะบะพะผ**
- โก **ะัะธะฝััะพะฝะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ั ะพัะตัะตะดัะผะธ**
- ๐ **ะะฐะทะพะฒะฐั HTTP ะฐะฒัะพัะธะทะฐัะธั** (admin/admin)

## ๐๏ธ ะขะตัะฝะพะปะพะณะธะธ

- **Backend**: Spring Boot 3.2, Java 17
- **Database**: H2 (dev) / PostgreSQL (prod)
- **Build**: Gradle 8.4
- **AI Services**: Ollama (ะดะปั ะพะฟัะตะดะตะปะตะฝะธั ะฟะตััะพะฝะฐะถะตะน ะธ ัะดะฐัะตะฝะธะน)
- **TTS**: F5-TTS (ะปะพะบะฐะปัะฝัะน ัะตัะฒะธั)
- **Queuing**: In-memory BlockingQueue ั ัะตะผะฐัะพัะฐะผะธ
- **Security**: Spring Security ั in-memory ะฟะพะปัะทะพะฒะฐัะตะปะตะผ

## ๐ ะขัะตะฑะพะฒะฐะฝะธั

- Java 17+
- Gradle 8.4+
- Ollama ัะตัะฒะตั (localhost:11434)
- F5-TTS ัะตัะฒะตั (localhost:5000)
- PostgreSQL (ะดะปั production)

## ๐ ะฃััะฐะฝะพะฒะบะฐ ะธ ะทะฐะฟััะบ

### ะะพะบะฐะปัะฝัะน ะทะฐะฟััะบ

```bash
# ะะปะพะฝะธัะพะฒะฐัั ัะตะฟะพะทะธัะพัะธะน
git clone https://github.com/lytvest/audio-tts-server.git
cd audio-tts-server

# ะะฐะฟัััะธัั ั H2 ะฑะฐะทะพะน ะดะฐะฝะฝัั
./gradlew bootRun

# ะะปะธ ะทะฐะฟัััะธัั ั PostgreSQL
./gradlew bootRun --args='--spring.profiles.active=postgresql'
```

### Docker ะทะฐะฟััะบ

```bash
# ะกะฑะพัะบะฐ ะฟัะธะปะพะถะตะฝะธั
./gradlew build

# ะะฐะฟััะบ ัะตัะตะท Docker Compose (ะฒะบะปััะฐะตั PostgreSQL, Ollama)
docker-compose up -d

# ะะฐะณััะทะบะฐ ะผะพะดะตะปะธ ะฒ Ollama (ะฟะพัะปะต ะทะฐะฟััะบะฐ ะบะพะฝัะตะนะฝะตัะพะฒ)
docker exec -it <ollama_container> ollama pull llama3.2
```

## ๐ API Documentation

### ะะฒัะพัะธะทะฐัะธั
ะัะต API ััะตะฑััั HTTP Basic Auth: `admin:admin`

### ะะฐะณััะทะบะฐ ะบะฝะธะณ

**ะะฐะณััะทะธัั FB2 ัะฐะนะป:**
```http
POST /api/books/upload
Content-Type: multipart/form-data
Authorization: Basic YWRtaW46YWRtaW4=

file: (FB2 ัะฐะนะป)
title: "ะะฐะทะฒะฐะฝะธะต ะบะฝะธะณะธ" (ะพะฟัะธะพะฝะฐะปัะฝะพ)
author: "ะะฒัะพั" (ะพะฟัะธะพะฝะฐะปัะฝะพ)
```

**ะะพะปััะธัั ัะฟะธัะพะบ ะบะฝะธะณ:**
```http
GET /api/books
Authorization: Basic YWRtaW46YWRtaW4=
```

**ะะพะปััะธัั ะบะฝะธะณั ั ะณะปะฐะฒะฐะผะธ:**
```http
GET /api/books/{bookId}
Authorization: Basic YWRtaW46YWRtaW4=
```

**ะะพะปััะธัั ััะฐัะธััะธะบั ะพะฑัะฐะฑะพัะบะธ:**
```http
GET /api/books/{bookId}/stats
Authorization: Basic YWRtaW46YWRtaW4=
```

### ะฃะฟัะฐะฒะปะตะฝะธะต ะฟัะตะดะปะพะถะตะฝะธัะผะธ

**ะะพะปััะธัั ะฟัะตะดะปะพะถะตะฝะธั ะฟะพ ััะฐัััั:**
```http
GET /api/sentences?status=WAITING_FOR_CHARACTER&page=0&size=20
Authorization: Basic YWRtaW46YWRtaW4=
```

**ะัะตะดะปะพะถะตะฝะธั ะณะปะฐะฒั:**
```http
GET /api/sentences/chapter/{chapterId}
Authorization: Basic YWRtaW46YWRtaW4=
```

**ะกะบะฐัะฐัั ะฐัะดะธะพ ะฟัะตะดะปะพะถะตะฝะธั:**
```http
GET /api/sentences/{sentenceId}/audio
Authorization: Basic YWRtaW46YWRtaW4=
```

### ะฃะฟัะฐะฒะปะตะฝะธะต ะฟะตััะพะฝะฐะถะฐะผะธ

**ะะพะปััะธัั ะฟะตััะพะฝะฐะถะตะน ะบะฝะธะณะธ:**
```http
GET /api/characters/book/{bookId}
Authorization: Basic YWRtaW46YWRtaW4=
```

**ะะฑะฝะพะฒะธัั ะฝะฐัััะพะนะบะธ ะฟะตััะพะฝะฐะถะฐ:**
```http
PUT /api/characters/{characterId}
Content-Type: application/json
Authorization: Basic YWRtaW46YWRtaW4=

{
  "voiceId": "russian_female",
  "voiceName": "ะัััะบะธะน ะถะตะฝัะบะธะน ะณะพะปะพั",
  "description": "ะะฟะธัะฐะฝะธะต ะฟะตััะพะฝะฐะถะฐ"
}
```

### ะกะบะฐัะธะฒะฐะฝะธะต ะฐัะดะธะพ

**ะกะบะฐัะฐัั ะณะปะฐะฒั:**
```http
GET /api/chapters/{chapterId}/audio
Authorization: Basic YWRtaW46YWRtaW4=
```

**ะกะบะฐัะฐัั ะบะฝะธะณั ะบะฐะบ ZIP:**
```http
GET /api/chapters/book/{bookId}/download
Authorization: Basic YWRtaW46YWRtaW4=
```

### ะกะธััะตะผะฝัะต API

**ะัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั:**
```http
GET /api/health
```

**ะะพัััะฟะฝัะต ะณะพะปะพัะฐ:**
```http
GET /api/voices
Authorization: Basic YWRtaW46YWRtaW4=
```

**ะกัะฐัะธััะธะบะฐ ะพัะตัะตะดะตะน:**
```http
GET /api/queue/stats
Authorization: Basic YWRtaW46YWRtaW4=
```

## ๐ง ะะพะฝัะธะณััะฐัะธั

### application.properties

```properties
# ะกะตัะฒะตั
server.port=8080

# ะะฐะทะฐ ะดะฐะฝะฝัั (H2 ะดะปั ัะฐะทัะฐะฑะพัะบะธ)
spring.datasource.url=jdbc:h2:mem:testdb
spring.h2.console.enabled=true

# ะฅัะฐะฝะธะปะธัะต ัะฐะนะปะพะฒ
app.storage.root-path=./storage
app.storage.books-path=${app.storage.root-path}/books
app.storage.audio-path=${app.storage.root-path}/audio

# ะะฝะตัะฝะธะต ัะตัะฒะธัั
app.ollama.base-url=http://localhost:11434
app.ollama.model=llama3.2
app.f5tts.base-url=http://localhost:5000

# ะัะตัะตะดะธ
app.processing.sentence-queue-size=100
app.processing.chapter-queue-size=50
```

### ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

```bash
# ะะปั production
export SPRING_PROFILES_ACTIVE=postgresql
export SPRING_DATASOURCE_URL=jdbc:postgresql://localhost:5432/audio_tts
export SPRING_DATASOURCE_USERNAME=postgres
export SPRING_DATASOURCE_PASSWORD=password

# ะะฝะตัะฝะธะต ัะตัะฒะธัั
export APP_OLLAMA_BASE_URL=http://ollama:11434
export APP_F5TTS_BASE_URL=http://f5tts:5000
```

## ๐ ะกัะฐัััะฝะฐั ะผะพะดะตะปั

### ะกัะฐัััั ะฟัะตะดะปะพะถะตะฝะธะน:
1. `WAITING_FOR_CHARACTER` - ะพะถะธะดะฐะตั ะพะฟัะตะดะตะปะตะฝะธั ะฟะตััะพะฝะฐะถะฐ
2. `DETERMINING_CHARACTER` - ะพะฟัะตะดะตะปะตะฝะธะต ะฟะตััะพะฝะฐะถะฐ ะฒ ะฟัะพัะตััะต
3. `WAITING_FOR_STRESS` - ะพะถะธะดะฐะตั ัะฐัััะฐะฝะพะฒะบะธ ัะดะฐัะตะฝะธะน
4. `SETTING_STRESS` - ัะฐัััะฐะฝะพะฒะบะฐ ัะดะฐัะตะฝะธะน ะฒ ะฟัะพัะตััะต
5. `WAITING_FOR_TTS` - ะพะถะธะดะฐะตั ะณะตะฝะตัะฐัะธะธ ะฐัะดะธะพ
6. `GENERATING_TTS` - ะณะตะฝะตัะฐัะธั ะฐัะดะธะพ ะฒ ะฟัะพัะตััะต
7. `READY` - ะณะพัะพะฒะพ

### ะกัะฐัััั ะณะปะฐะฒ:
1. `WAITING` - ะพะถะธะดะฐะตั ะพะฑัะฐะฑะพัะบะธ
2. `IN_PROGRESS` - ะฒ ะฟัะพัะตััะต ะพะฑัะฐะฑะพัะบะธ
3. `READY` - ะณะพัะพะฒะฐ

## ๐๏ธ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ
โ   REST API      โ    โ   Services   โ    โ  External   โ
โ                 โ    โ              โ    โ  Services   โ
โ BookController  โโโโโถโ BookService  โโโโโถโ   Ollama    โ
โSentenceCtrl     โ    โSentenceProc. โ    โ   F5-TTS    โ
โChapterCtrl      โ    โChapterServiceโ    โ             โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ
         โ                       โ
         โผ                       โผ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ
โ   Repositories  โ    โ   Queues     โ
โ                 โ    โ              โ
โ BookRepository  โ    โCharacter     โ
โSentenceRepo     โ    โStress        โ
โChapterRepo      โ    โTTS           โ
โCharacterRepo    โ    โ              โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ
         โ                       โ
         โผ                       โผ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ
โ    Database     โ    โ Async        โ
โ                 โ    โ Processors   โ
โ H2 / PostgreSQL โ    โ              โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ
```

## ๐ ะัะพัะตัั ะพะฑัะฐะฑะพัะบะธ

1. **ะะฐะณััะทะบะฐ FB2** โ ะะฐััะธะฝะณ โ ะกะพะทะดะฐะฝะธะต Book/Chapter/Sentence
2. **ะะฟัะตะดะตะปะตะฝะธะต ะฟะตััะพะฝะฐะถะตะน** โ Ollama API โ ะะฑะฝะพะฒะปะตะฝะธะต Sentence
3. **ะะฐัััะฐะฝะพะฒะบะฐ ัะดะฐัะตะฝะธะน** โ Ollama API โ ะะฑะฝะพะฒะปะตะฝะธะต ัะตะบััะฐ
4. **ะะตะฝะตัะฐัะธั ะฐัะดะธะพ** โ F5-TTS API โ ะกะพััะฐะฝะตะฝะธะต MP3
5. **ะะพัะพะฒะฝะพััั** โ ะะพัััะฟะฝั ะดะปั ัะบะฐัะธะฒะฐะฝะธั

## ๐ณ Docker

### Dockerfile
```dockerfile
FROM openjdk:17-jdk-slim
COPY build/libs/*.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]
```

### docker-compose.yml
ะะบะปััะฐะตั PostgreSQL ะธ ะทะฐะณะพัะพะฒะบะธ ะดะปั Ollama ะธ F5-TTS ัะตัะฒะธัะพะฒ.

## ๐ค ะะฐะทัะฐะฑะพัะบะฐ

### ะกัััะบัััะฐ ะฟัะพะตะบัะฐ:
```
src/main/java/com/lytvest/audiotts/
โโโ controller/          # REST ะบะพะฝััะพะปะปะตัั
โโโ service/            # ะะธะทะฝะตั-ะปะพะณะธะบะฐ
โ   โโโ external/       # ะะฝัะตะณัะฐัะธะธ ั ะฒะฝะตัะฝะธะผะธ API
โ   โโโ processor/      # ะัะธะฝััะพะฝะฝัะต ะพะฑัะฐะฑะพััะธะบะธ
โ   โโโ queue/          # ะฃะฟัะฐะฒะปะตะฝะธะต ะพัะตัะตะดัะผะธ
โโโ model/              # ะะพะดะตะปะธ ะดะฐะฝะฝัั
โ   โโโ entity/         # JPA ัััะฝะพััะธ
โ   โโโ enums/          # ะะตัะตัะธัะปะตะฝะธั
โโโ repository/         # ะะตะฟะพะทะธัะพัะธะธ JPA
โโโ dto/               # DTO ะดะปั API
โโโ config/            # ะะพะฝัะธะณััะฐัะธั Spring
```

### ะะฐะฟััะบ ัะตััะพะฒ:
```bash
./gradlew test
```

### ะกะฑะพัะบะฐ:
```bash
./gradlew build
```

## ๐ ะะธัะตะฝะทะธั

ะญัะพั ะฟัะพะตะบั ัะฐัะฟัะพัััะฐะฝัะตััั ะฟะพะด ะปะธัะตะฝะทะธะตะน MIT. ะะพะดัะพะฑะฝะพััะธ ะฒ ัะฐะนะปะต [LICENSE](LICENSE).

## ๐จโ๐ป ะะฒัะพั

- **ะะผะธััะธะน ะะฐัะบะธััะตะฒ** - [lytvest](https://github.com/lytvest)

## ๐ ะะพะดะดะตัะถะบะฐ

ะัะปะธ ั ะฒะฐั ะตััั ะฒะพะฟัะพัั ะธะปะธ ะฟัะตะดะปะพะถะตะฝะธั:
- ะกะพะทะดะฐะนัะต [issue](https://github.com/lytvest/audio-tts-server/issues)
- ะะพัะผะพััะธัะต ะปะพะณะธ: `docker-compose logs -f audio-tts-server`
- ะัะพะฒะตัััะต ััะฐััั ะพัะตัะตะดะตะน: `GET /api/queue/stats`

## ๐ฎ Roadmap

- [ ] ะะตะฑ-ะธะฝัะตััะตะนั ะดะปั ัะฟัะฐะฒะปะตะฝะธั
- [ ] ะะพะดะดะตัะถะบะฐ ะดััะณะธั ัะพัะผะฐัะพะฒ (EPUB, TXT)
- [ ] ะฃะปัััะตะฝะฝะพะต ะพะฑัะตะดะธะฝะตะฝะธะต ะฐัะดะธะพ ัะฐะนะปะพะฒ
- [ ] ะััะธัะพะฒะฐะฝะธะต ะพะฟัะตะดะตะปะตะฝะธะน ะฟะตััะพะฝะฐะถะตะน
- [ ] ะะตััะธะบะธ ะธ ะผะพะฝะธัะพัะธะฝะณ
- [ ] API ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะณะพะปะพัะฐะผะธ
